hotkey('x', 'escape_screen(); assignin(''caller'',''continue_'',false);');
if SIMULATION_MODE, tracker = eye_; else, tracker = joy_; end  % use mouse for simulation

pacman = PacmanUnit(tracker);
blinky = BlinkyUnit(null_);
clyde = ClydeUnit(null_);
wall = WallGraphic(null_);
base = BaseGraphic(null_);
dot = DotGraphic(null_);
energizer = EnergizerGraphic(null_);
game = GameManager(pacman);
game.add(blinky);
game.add(clyde);
game.add(wall);
game.add(base);
game.add(dot);
game.add(energizer);

wall.Rect = [0 0 1000 10; ...  % horizontal
    90 90 100 10; 360 90 280 10; 810 90 100 10; ...
    90 180 370 10; 540 180 370 10; ...
    360 270 100 10; 540 270 100 10; ...
    360 360 100 10; 540 360 100 10; ...
    270 450 100 10; 630 450 100 10; ...
    270 540 190 10; 540 540 190 10; ...
    90 630 190 10; 360 630 280 10; 720 630 190 10; ...
    0 720 1000 10; ...
    
    0 0 10 730; ...  % vertical
    90 270 10 100; 90 450 10 100; ...
    180 270 10 280; ...
    270 90 10 190; 270 360 10 100; ...
    360 270 10 100; ...
    450 450 10 100; ...
    540 450 10 100; ...
    630 270 10 100; ...
    720 90 10 190; 720 360 10 100; ...
    810 270 10 280; ...
    900 270 10 100; 900 450 10 100; ...
    990 0 10 730; ...
    ];
base.Rect = [460 270 80 10;
    460 360 80 10; ...
    ];

dot_pos = [50 50; 140 50; 230 50; 320 50; 410 50; 500 50; 590 50; 680 50; 770 50; 870 50; 960 50; ...
    50 140; 140 140; 230 140; 320 140; 410 140; 500 140; 590 140; 680 140; 770 140; 870 140; 960 140; ...
    50 230; 140 230; 230 230; 770 230; 870 230; 960 230; ...
    50 320; 140 320; 230 320; 770 320; 870 320; 960 320; ...
    50 410; 140 410; 230 410; 770 410; 870 410; 960 410; ...
    50 500; 140 500; 230 500; 320 500; 410 500; 500 500; 590 500; 680 500; 770 500; 870 500; 960 500; ...
    50 590; 140 590; 230 590; 320 590; 410 590; 590 590; 680 590; 770 590; 870 590; 960 590; ...
    50 680; 140 680; 230 680; 320 680; 410 680; 500 680; 590 680; 680 680; 770 680; 870 680; 960 680; ...
    ];
idx = randperm(size(dot_pos,1),2);
energizer_pos = dot_pos(idx,:);
dot_pos(idx,:) = [];
dot.Position = dot_pos;
energizer.Position = energizer_pos;

scene = create_scene(game);
run_scene(scene);
